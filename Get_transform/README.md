# 批量文件对比和清理工具

## 功能概述

这个工具用于对比 `history` 文件夹下的不同时间版本，自动删除最新版本中与旧版本重复的文件。

## 功能特性

- **智能时间戳识别**: 自动解析文件夹名中的时间戳格式 (YYYYMMDDHHMM)
- **版本排序**: 按时间戳自动排序，识别最新和历史版本
- **重复文件检测**: 精确识别最新文件夹中与历史版本重复的文件
- **安全删除机制**: 提供试运行、备份、确认等多重安全保障
- **智能文件复制重命名**: 解析index.html中的标题映射，将HTML文件复制到指定目录并重命名为有意义的标题

## 工作原理

1. **时间戳识别**：从文件夹名称中提取时间戳（格式：`voicenotes_YYYYMMDDHHMM_...`）
2. **版本排序**：按时间戳对文件夹进行排序，识别最新和旧版本
3. **文件对比**：比较各版本 `notes/` 目录下的文件名
4. **重复删除**：删除最新版本中与任何旧版本重复的文件

## 文件结构要求

```
Get_transform/
├── history/
│   ├── voicenotes_202510171604_getnotes_archive_xxx/
│   │   ├── index.html
│   │   └── notes/
│   │       ├── file1.html
│   │       ├── file2.html
│   │       └── ...
│   └── voicenotes_202510241143_getnotes_archive_yyy/
│       ├── index.html
│       └── notes/
│           ├── file1.html  # 与旧版本重复，将被删除
│           ├── file3.html  # 新文件，保留
│           └── ...
├── duplicate_file_cleaner.py
└── README.md
```

## 使用方法

### 1. 基本使用

**步骤1：进入项目目录**
```把地址替换成你的存放目录，在powershell中运行以下命令
cd "c:\Your_file\Get_transform"
```

**步骤2：运行脚本**
```在powershell中运行以下命令
python duplicate_file_cleaner.py
```

> **注意**：请确保已安装Python 3.6+，并且Python已添加到系统PATH环境变量中。

### 2. 操作选项

运行后会显示菜单：

```
请选择操作:
1. 试运行 (查看将要删除的文件，不实际删除)
2. 正式运行 (实际删除重复文件)
3. 仅复制重命名 (不删除重复文件，仅将最新文件夹中的HTML文件复制到new目录并重命名)
4. 退出
```

### 3. 推荐流程

1. **先运行试运行模式**：选择选项 `1`，查看将要删除的文件列表
2. **确认无误后正式运行**：选择选项 `2`，执行实际删除操作
3. **仅需复制**：如果只想复制重命名文件而不删除重复文件，选择选项 `3`
4. **选择是否备份**：正式运行时可选择是否创建备份

### 文件复制重命名功能
- **自动解析**: 读取最新文件夹中的index.html，提取笔记标题与文件名的映射关系
- **智能重命名**: 将HTML文件从哈希文件名重命名为有意义的标题
- **目标目录**: 复制到脚本所在目录下的 `new` 文件夹
- **文件名清理**: 自动处理特殊字符，确保文件名符合Windows文件系统要求

#### 示例
原文件: `9323c2f00816d6a7cfffabb9b8ea1ad5.html`
重命名为: `太变态！这个AI工具从写代码到发推啥都能干.html`

## 安全特性

### 1. 试运行模式
- 不会实际删除任何文件
- 显示所有将要删除的文件路径
- 统计重复文件数量

### 2. 备份功能
- 正式运行前可选择创建完整备份
- 备份文件夹命名格式：`原文件夹名_backup_YYYYMMDD_HHMMSS`
- 备份包含整个文件夹的完整副本

### 3. 详细日志
- 自动生成日志文件：`file_cleaner_YYYYMMDD_HHMMSS.log`
- 记录所有操作步骤和结果
- 包含错误信息和警告

### 4. 确认机制
- 正式删除前需要输入 `YES` 确认
- 防止误操作

## 示例输出

### 试运行结果
```
2025-10-24 14:35:31,647 - INFO - 日志文件创建: file_cleaner_20251024_143531.log
2025-10-24 14:35:31,648 - INFO - 发现文件夹: voicenotes_202510171604_getnotes_archive_xxx (时间戳: 202510171604)
2025-10-24 14:35:31,648 - INFO - 发现文件夹: voicenotes_202510241143_getnotes_archive_yyy (时间戳: 202510241143)
2025-10-24 14:35:31,649 - INFO - 最新文件夹: voicenotes_202510241143_getnotes_archive_yyy (时间戳: 202510241143)
2025-10-24 14:35:31,649 - INFO - 旧文件夹数量: 1
2025-10-24 14:35:31,650 - INFO - 在 notes 中找到 579 个文件
2025-10-24 14:35:31,651 - INFO - 在 notes 中找到 457 个文件
2025-10-24 14:35:31,651 - INFO - 与 voicenotes_202510171604_getnotes_archive_xxx 重复的文件数量: 457
2025-10-24 14:35:31,651 - INFO - 发现 457 个重复文件
2025-10-24 14:35:31,652 - INFO - [试运行] 将删除: file1.html
2025-10-24 14:35:31,652 - INFO - [试运行] 将删除: file2.html
...
2025-10-24 14:35:31,682 - INFO - 清理操作完成
2025-10-24 14:35:31,682 - INFO - 重复文件数量: 457
2025-10-24 14:35:31,682 - INFO - 删除文件数量: 0

试运行结果: 清理操作完成
发现重复文件: 457 个
```

## 注意事项

### ⚠️ 重要警告
1. **数据安全**：删除操作不可逆，建议先创建备份
2. **文件夹命名**：确保文件夹名称包含正确的时间戳格式
3. **权限要求**：确保有足够权限读写目标文件夹

### 💡 使用建议
1. **首次使用**：务必先运行试运行模式
2. **定期备份**：重要数据建议定期备份到其他位置
3. **检查日志**：操作后检查日志文件确认结果

### 🔧 故障排除

#### 问题：找不到文件夹
- **原因**：history目录不存在或路径错误
- **解决**：检查脚本中的 `history_dir` 路径设置

#### 问题：无法解析时间戳
- **原因**：文件夹命名格式不符合要求
- **解决**：确保文件夹名称包含 `voicenotes_YYYYMMDDHHMM_` 格式

#### 问题：权限不足
- **原因**：没有文件删除权限
- **解决**：以管理员身份运行或检查文件夹权限

## 自定义配置

如需修改默认路径，编辑脚本中的配置：

```python
# 在 main() 函数中修改
history_dir = r"你的自定义路径\history"
```

## 技术细节

- **语言**：Python 3.6+
- **依赖**：仅使用标准库，无需额外安装
- **兼容性**：Windows/Linux/macOS
- **编码**：UTF-8，支持中文路径和文件名

## 版本信息

- **版本**：1.0
- **创建时间**：2025-01-27
- **作者**：AI Assistant
- **许可证**：MIT

## 联系支持

如遇到问题或需要功能改进，请提供：
1. 错误日志文件
2. 文件夹结构截图
3. 具体错误描述